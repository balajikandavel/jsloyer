<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Themes on JeffSloyer.io</title>
    <link>http://www.jeffsloyer.io/tags/themes/index.xml</link>
    <description>Recent content in Themes on JeffSloyer.io</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>Code released under the Apache 2.0 license.</copyright>
    <atom:link href="http://www.jeffsloyer.io/tags/themes/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Zero Downtime Deployments with Bluemix</title>
      <link>http://www.jeffsloyer.io/post/zero-downtime-deployments-with-bluemix/</link>
      <pubDate>Mon, 18 Aug 2014 22:10:32 -0500</pubDate>
      
      <guid>http://www.jeffsloyer.io/post/zero-downtime-deployments-with-bluemix/</guid>
      <description>&lt;p&gt;In Cloud Foundry (the open source technology behind Bluemix), when you do a &lt;code&gt;cf push&lt;/code&gt;, Cloud Foundry will actually stop your app and restart it with the new code that you just uploaded.  This presents an issue for a production app or any app that is actually serving users. There is a shortcoming with the current DEA (the part in Cloud Foundry that runs your app) but the next version of the DEA (&lt;a href=&#34;https://www.youtube.com/watch?v=1OkmVTFhfLY&#34;&gt;Diego&lt;/a&gt;) will help address this.  In the meantime you can do a little scripting to get around this.&lt;/p&gt;

&lt;p&gt;The basic flow is as follows:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;App A is running (prod)&lt;/li&gt;
&lt;li&gt;Deploy App B&lt;/li&gt;
&lt;li&gt;Do some tests against App B&lt;/li&gt;
&lt;li&gt;Map prod route to App B&lt;/li&gt;
&lt;li&gt;Unmap prod route from App A&lt;/li&gt;
&lt;li&gt;Stop App A&lt;/li&gt;
&lt;li&gt;Delete App A&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Here is some starter shell code to do it:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# deploy.sh

#!/bin/bash
cf unmap-route blue-app mybluemix.net -n cf-blue-green          # make the app unavailable to requests
cf push blue-app

# wait for the blue app to start
while true; do
RESP=`curl -sIL -w &amp;quot;%{http_code}&amp;quot; &amp;quot;blue-app.mybluemix.net&amp;quot; -o /dev/null`
if [[ $RESP == &amp;quot;200&amp;quot; ]]
then break
else sleep 3 &amp;amp;amp;&amp;amp;amp; echo &amp;quot;Waiting for 200 response&amp;quot;
fi
done

# make the blue app available to the router
cf map-route blue-app mybluemix.net -n cf-blue-green

# deploy to the green app
cf unmap-route green-app mybluemix.net -n cf-blue-green
cf push green-app
cf app green-app
cf map-route green-app mybluemix.net -n cf-blue-green
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
  </channel>
</rss>